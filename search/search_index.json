{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":"<p>This documentation site describes the components of the Beyond All Reason (BAR) Infrastructure and how they connect to each other.</p> <p>On a very high level:</p> InfrastructureRecoil EngineGame Online ServicesGame ServersLobby ClientLobby ServerBeyond All Reason Game InfrastructureRecoil EngineGame Online ServicesGame ServersLobby ClientLobby ServerBeyond All Reason Game <p>Infrastructure contains all the software, configuration, and resources that support the running of the Beyond All Reason game on the Recoil Engine, which includes: lobby server, launcher, game files hosting, multiplayer game servers, server management, and more.</p> <p>Please explore the site for any information that you are interested in. If you are just starting, we recommend looking at the more detailed system overview. If you would like to help out, check out the contributing page.</p> <p>Happy reading \ud83d\ude42!</p>"},{"location":"assets_serving/","title":"Assets Serving","text":"<p>Warning</p> <p>Unfinished section, the diagrams are up to date, but no textual explanations yet.</p>"},{"location":"assets_serving/#legend","title":"Legend","text":"<p>GitHubCloudflareGoogle CloudVirtual MachineOther GitHubCloudflareGoogle CloudVirtual MachineOther </p>"},{"location":"assets_serving/#overview","title":"Overview","text":"<p>userRapidMaps Metadatahttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/servingError Logshttps://log.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/logs-uploadLauncher Confighttps://launcher-config.beyondallreason.dev/config.json  Source: https://github.com/p2004a/spring-launcher-config-srvFileshttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hostingPoolHosts only https://pool-init.beyondallreason.dev/data.7zRowyhttps://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloudMaps MetadataPool package buildChobbySPADS ConfigGoogle Drive MapsMain WebsiteWhat is hosted on https://www.beyondallreason.info/maps  Build using WebflowworkerworkerworkerR2R2 MetadataR2 ImagesKVR2 readreadImage transformread/writeread/writesync single mapsave imagesreadwritePush commitPush commitPush metadataSync mapsPullPush dist_cfg/config.jsonhttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/serving https://log.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/logs-upload https://launcher-config.beyondallreason.dev/config.json  Source: https://github.com/p2004a/spring-launcher-config-srv https://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hosting Hosts only https://pool-init.beyondallreason.dev/data.7z https://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud What is hosted on https://www.beyondallreason.info/maps  Build using Webflow userRapidMaps Metadatahttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/servingError Logshttps://log.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/logs-uploadLauncher Confighttps://launcher-config.beyondallreason.dev/config.json  Source: https://github.com/p2004a/spring-launcher-config-srvFileshttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hostingPoolHosts only https://pool-init.beyondallreason.dev/data.7zRowyhttps://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloudMaps MetadataPool package buildChobbySPADS ConfigGoogle Drive MapsMain WebsiteWhat is hosted on https://www.beyondallreason.info/maps  Build using WebflowworkerworkerworkerR2R2 MetadataR2 ImagesKVR2 readreadImage transformread/writeread/writesync single mapsave imagesreadwritePush commitPush commitPush metadataSync mapsPullPush dist_cfg/config.jsonhttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/serving https://log.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/logs-upload https://launcher-config.beyondallreason.dev/config.json  Source: https://github.com/p2004a/spring-launcher-config-srv https://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hosting Hosts only https://pool-init.beyondallreason.dev/data.7z https://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud What is hosted on https://www.beyondallreason.info/maps  Build using Webflow </p>"},{"location":"assets_serving/#files","title":"Files","text":"<p>userFileshttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hostingSpringFilesFilesRecoil EngineworkerR2 Assets3 buckets geographically distributes across North America, Europe, and Asia.KVCache PubSubCacherMaps Upload BucketMappers have permission to directly put new map files there via web interface to upload them to CDN.  https://console.cloud.google.com/storage/browser/bar-springfiles-syncer_assets-upload readreadsyncfallback lookupPubSub Upload triggertriggerwritewritereaddownload releasereadNew releasehttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hosting 3 buckets geographically distributes across North America, Europe, and Asia. Mappers have permission to directly put new map files there via web interface to upload them to CDN.  https://console.cloud.google.com/storage/browser/bar-springfiles-syncer_assets-upload userFileshttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hostingSpringFilesFilesRecoil EngineworkerR2 Assets3 buckets geographically distributes across North America, Europe, and Asia.KVCache PubSubCacherMaps Upload BucketMappers have permission to directly put new map files there via web interface to upload them to CDN.  https://console.cloud.google.com/storage/browser/bar-springfiles-syncer_assets-upload readreadsyncfallback lookupPubSub Upload triggertriggerwritewritereaddownload releasereadNew releasehttps://files-cdn.beyondallreason.dev/  Source: https://github.com/beyond-all-reason/maps-hosting 3 buckets geographically distributes across North America, Europe, and Asia. Mappers have permission to directly put new map files there via web interface to upload them to CDN.  https://console.cloud.google.com/storage/browser/bar-springfiles-syncer_assets-upload </p>"},{"location":"assets_serving/#rapid","title":"Rapid","text":"<p>userBunny CDNUsed only for hosting Rapid repo, domain https://repos-cdn.beyondallreason.dev/.  We are using https://bunny.net/Rapid Build ServerManaged with Ansible playbook: https://github.com/beyond-all-reason/rapid-hostingRapid SyncerChobbyBeyond-All-ReasonBucketEdge RulecronRapidToolsRapidTools is package that is used to actually compile git repository to Rapid format  Source: https://github.com/beyond-all-reason/RapidToolsRapid RepoGit CheckoutsHTTP ServerUpdate ScriptschedulerCDN SyncerVersion Pinner invokewritetriggerreadwritereadtriggertriggerreadread/writePin latest versionGit pullGit pullTrigger build (ssh)Trigger build (ssh)triggertriggertriggertriggerUsed only for hosting Rapid repo, domain https://repos-cdn.beyondallreason.dev/.  We are using https://bunny.net/ Managed with Ansible playbook: https://github.com/beyond-all-reason/rapid-hosting RapidTools is package that is used to actually compile git repository to Rapid format  Source: https://github.com/beyond-all-reason/RapidTools userBunny CDNUsed only for hosting Rapid repo, domain https://repos-cdn.beyondallreason.dev/.  We are using https://bunny.net/Rapid Build ServerManaged with Ansible playbook: https://github.com/beyond-all-reason/rapid-hostingRapid SyncerChobbyBeyond-All-ReasonBucketEdge RulecronRapidToolsRapidTools is package that is used to actually compile git repository to Rapid format  Source: https://github.com/beyond-all-reason/RapidToolsRapid RepoGit CheckoutsHTTP ServerUpdate ScriptschedulerCDN SyncerVersion Pinner invokewritetriggerreadwritereadtriggertriggerreadread/writePin latest versionGit pullGit pullTrigger build (ssh)Trigger build (ssh)triggertriggertriggertriggerUsed only for hosting Rapid repo, domain https://repos-cdn.beyondallreason.dev/.  We are using https://bunny.net/ Managed with Ansible playbook: https://github.com/beyond-all-reason/rapid-hosting RapidTools is package that is used to actually compile git repository to Rapid format  Source: https://github.com/beyond-all-reason/RapidTools </p>"},{"location":"assets_serving/#rowy","title":"Rowy","text":"<p>userMaps Metadatahttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/servingRowyhttps://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloudMaps MetadataworkerR2 MetadataR2 ImagesImagorFrontendFirebase frontend, https://rowy.beyondallreason.dev/FirestoreMap ParserGithub TriggerUploaded Assets BucketParsed Maps Bucket readreadImage transformread/writereadread/writeinvokeinvokewritereadreadwritesync single mapPush metadataPullhttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/serving https://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud Firebase frontend, https://rowy.beyondallreason.dev/ userMaps Metadatahttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/servingRowyhttps://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloudMaps MetadataworkerR2 MetadataR2 ImagesImagorFrontendFirebase frontend, https://rowy.beyondallreason.dev/FirestoreMap ParserGithub TriggerUploaded Assets BucketParsed Maps Bucket readreadImage transformread/writereadread/writeinvokeinvokewritereadreadwritesync single mapPush metadataPullhttps://maps-metadata.beyondallreason.dev/  Cloudflare worker serving data from R2 bucket  https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud/serving https://rowy.beyondallreason.dev/  Our own deployment of Rowy with custom patches as Firebase app on GCP.  There is also a bunch of small services there to support syncing, inside https://github.com/beyond-all-reason/maps-metadata/tree/main/cloud Firebase frontend, https://rowy.beyondallreason.dev/ </p>"},{"location":"components/","title":"Components Index","text":"<p>Infra is spread across many different repositories, with different functions. On this page is a current comprehensive list (index like) of everything that BAR infrastructure consists of.</p> <p>Note</p> <p>Even though many of the repositories below are hosting UI visible to players, the infrastructure team is not responsible for the design and overall UX improvements. The same applies to rating, balancing and data analysis. Other BAR development teams are supposed to drive planning and improvements to those aspects.</p>"},{"location":"components/#live-games-serving","title":"Live games serving","text":"<p>The server side components responsible for facilitating live games: hosting the engine instances clients connect to to play the game.</p> <ul> <li>Yaribz/SPADS: Game lobby room hosting and engine handling on game servers.</li> <li>spads_config_bar: Spads configuration, bar manager plugin, official plugins   configuration.</li> <li>ansible-spads-setup: Overall game servers configuration.</li> <li>recoil-autohost: Work in progress tachyon protocol autohost.</li> </ul> <p>There is also some monitoring setup: health checks using healthchecks.io and Okema's Zabbix instance.</p>"},{"location":"components/#lobby-rooms-serving","title":"Lobby rooms serving","text":"<p>The online components needed to set up and prepare the lobby rooms before the game happens.</p> <ul> <li> <p>teiserver: The primary piece here responsible for all the:</p> <ul> <li>Account management logic</li> <li>Moderation</li> <li>Lobby rooms permissions and management</li> <li>Middleware between client side components and SPADS</li> </ul> <p>hailstorm are the integration tests.</p> </li> <li> <p>ansible-teiserver: Teiserver server configuration.</p> </li> <li>tachyon: Work in progress new lobby server protocol specification.</li> <li>Even though the SPADS and its configuration is mentioned in the previous   section, it also belongs here. SPADS is handling both lobby rooms setup and   then game handling.</li> </ul>"},{"location":"components/#client-side-infra","title":"Client side infra","text":"<p>Pieces responsible for ensuring that players have all the assets available and ready to start the game.</p> <ul> <li> <p>BYAR-Chobby: Our current lobby client.</p> <p>It's responsible for communication with lobby server, launcher, preparing engine start script.</p> </li> <li> <p>bar-lobby: New work in progress lobby client.</p> </li> <li>spring-launcher: Game installer and launcher.<ul> <li>flathub/info.beyondallreason.bar: Linux Flatpak package for launcher.</li> </ul> </li> <li> <p>pr-downloader: CLI application distributed with engine used for downloading   mods/games</p> <p>Could be interpreted also to belong in the engine team, but it heavily impacts infra.</p> </li> <li> <p>bar_debug_launcher: BAR Debug launcher. It's not intended for end users,   it is a developer tool.</p> </li> </ul>"},{"location":"components/#game-assets-distribution","title":"Game assets distribution","text":"<p>Infrastructure responsible for making all the game assets available to players.</p> <ul> <li>RapidTools: Packaging of game git repo to rapid format.</li> <li>rapid-hosting: Rapid build server configuration.</li> <li>Game CDN distribution: CDN management and syncers to CDN.<ul> <li>recoil-rapid-syncer: Rapid repo syncer from builder host to CDN.   Also includes a prober to for debugging CDN replication issues.</li> <li>p2004a/bar-repos-bunny-replication-lag-mitigation: Helper to make sure   updates to CDN are pushed in consistent way.</li> <li>p2004a/rapid-pool-init: Builder for the initial rapid game download.   package.</li> </ul> </li> <li>maps-hosting: Map CDN: publishing, serving, IaC setup.</li> <li>Maps metadata setup<ul> <li>maps-metadata: Main repo that transforms data and distributes to other   places via GitHub actions. Also contains source for a few server side   components of that system.</li> <li>Maintenance of https://rowy.beyondallreason.dev/ (deployment with custom BAR patches).</li> </ul> </li> </ul>"},{"location":"components/#auxiliary-services","title":"Auxiliary services","text":"<ul> <li>BAR Live services (replays, leaderboard, battles linked as <code>iframe</code>s from www.beyondallreason.info):<ul> <li>bar-db: Backend service, effectively https://api.bar-rts.com/</li> <li>bar-live-services: Frontend embeded in main website https://bar-rts.com/</li> </ul> </li> <li>Teiserver contains some additional functionality in this category:<ul> <li>Microblog</li> <li>Discord bot</li> <li>Engine crash logs</li> </ul> </li> <li>logs-upload: Small Cloudflare worker to handle log upload from launcher.</li> <li>Main website is created in Webflow and not part of BAR   infrastructure.</li> </ul>"},{"location":"contributing/","title":"Contributing to BAR Infrastructure","text":"<p>Welcome! We're a volunteer-driven project, and we're excited you're here to help. This page will guide you on how to get started with the Beyond All Reason infrastructure.</p> <p>Tip</p> <p>This documentation is a new and evolving resource. If you find anything unclear or have unanswered questions, we welcome your feedback! Please open an issue to share your thoughts. Contributing to the docs is also a fantastic way to make your first contribution.</p> <p>Our core philosophy is applying software engineering to operations. We try to build robust solutions, and that often means changing code or building new tools, not just managing servers.</p>"},{"location":"contributing/#communication","title":"Communication","text":"<ul> <li>Discord: For general questions and discussions, join us in the development channels on the BAR Discord server. We have dedicated channels for different parts of the infrastructure, such as <code>#new-client</code> and <code>#teiserver-spads</code>. If no existing channel fits just post in <code>#dev-main</code>.</li> <li>GitHub: For tracking work and having more permanent discussions, we use GitHub Issues.</li> </ul> <p>At the moment the main point of contact for infrastructure is Marek (p2004a).</p>"},{"location":"contributing/#getting-started","title":"Getting Started","text":""},{"location":"contributing/#1-understand-the-big-picture","title":"1. Understand the Big Picture","text":"<p>Before diving in, take some time to browse this documentation site to understand how the system works. We recommend starting with the Home page for a high-level overview, and then moving on to the Runtime Infrastructure page for more details.</p>"},{"location":"contributing/#2-find-something-to-work-on","title":"2. Find Something to Work On","text":"<p>A great way to start is by tackling an existing issue. Check the issue trackers in the repositories listed in the Component Index that interest you.</p> <p>Look for issues tagged with <code>good first issue</code>, as these are well-suited for new contributors. While not all repositories may have them, it's a good starting point.</p> <p>Some larger cross-system issues/projects are tracked in the <code>infrastructure</code> repository.</p>"},{"location":"contributing/#cant-find-anything","title":"Can't Find Anything?","text":"<p>If you've looked for an issue but are still unsure where to start, feel free to ask. To help us point you in the right direction, please tell us a bit about your interests and what parts of the project you've already looked at.</p>"},{"location":"contributing/#3-taking-initiative","title":"3. Taking Initiative","text":"<p>Many potential improvements aren't tracked in an issue yet. If you have an idea or find something to improve, please bring it up for discussion! We value proactive contributions.</p> <p>Example</p> <p>To give you a sense of the possibilities, here are a couple of examples of areas that just aren't scoped as issues at the moment:</p> <ul> <li>Finishing the Recoil Engine docker build (e.g., adding Windows testing or Podman support).</li> <li>Reducing the complexity of the game's infrastructure build process, which has some quirks for historical reasons.</li> </ul> <p>As you learn more about the project and how things are connected together issues like this will pop up to you very quickly.</p>"},{"location":"contributing/#the-contribution-process","title":"The Contribution Process","text":"<ol> <li>Find or create an issue. This helps track the work.</li> <li>Check for a <code>CONTRIBUTING.md</code> file. It might contain specific guidelines relevant to that repository.</li> <li>For larger changes, agree on a plan first. This ensures we're all on the same page and you don't waste your time.</li> <li>Fork the repo, create a branch, write your code, submit a pull request. Following the standard GitHub Flow process.</li> </ol> <p>We look forward to your contributions!</p>"},{"location":"current_infra/","title":"Runtime Infrastructure","text":"<p>On this page, we describe the components of the \"Runtime\" infrastructure: roughly what players interact with in a direct way to play local and multiplayer games, browse the website, etc.</p> <p>All components of the runtime infrastructure also need to fetch different assets and configurations to function, and that part is described on the Assets Serving page.</p> <p>Important</p> <p>This page covers how we the runtime infrastructure looks like right now. The large strategic New Lobby Client project is going to change a lot of this, and makes some existing runtime components in maintanance mode.</p>"},{"location":"current_infra/#system-diagram","title":"System diagram","text":"<p>Tip</p> <p>Elements with \u24d8 on the diagram have tooltips. Hover over them to see more information.</p> <p>PlayerPlayer's PCMain Websitehttps://www.beyondallreason.info, built using [Webflow](https://webflow.com/)Game ServerAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setupAssets ServingWe use multiple CDNs and endpoints for hosting different game assets and configuration.  We don't include all the arrows on the diagram for clarity.Email ServerDiscordLobby ServerThe server is provisioned and configured via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-teiserverBAR Live ServicesBAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db<p>SpringLobby Protocol: https://github.com/spring/LobbyProtocol</p> Spring LauncherResponsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcherRecoil Engine (dedicated)A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface.SPADSManages individual lobby rooms  Repo: https://github.com/Yaribz/SPADSGame AssetsRecoil Enginepr-downloaderCLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloaderGame AssetsEngine, Maps, Game filesTeiserverThe main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/PostgreSQLChobbyThe lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-ChobbyBAR GameThe actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason startsusesstarts Autohost ProtocolreadsreadsstartsstartsCLI invokewritesreadsbridge protocolSMTPSpringLobby protocolSpringLobby protocolEngine ProtocolSpringLobby protocoluploads replaysembedshttps://www.beyondallreason.info, built using [Webflow](https://webflow.com/) All game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setup We use multiple CDNs and endpoints for hosting different game assets and configuration.  We don't include all the arrows on the diagram for clarity. The server is provisioned and configured via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-teiserver BAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db Responsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcher A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface. Manages individual lobby rooms  Repo: https://github.com/Yaribz/SPADS CLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloader Engine, Maps, Game files The main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/ The lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-Chobby The actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason PlayerPlayer's PCMain Websitehttps://www.beyondallreason.info, built using [Webflow](https://webflow.com/)Game ServerAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setupAssets ServingWe use multiple CDNs and endpoints for hosting different game assets and configuration.  We don't include all the arrows on the diagram for clarity.Email ServerDiscordLobby ServerThe server is provisioned and configured via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-teiserverBAR Live ServicesBAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db<p>SpringLobby Protocol: https://github.com/spring/LobbyProtocol</p> Spring LauncherResponsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcherRecoil Engine (dedicated)A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface.SPADSManages individual lobby rooms  Repo: https://github.com/Yaribz/SPADSGame AssetsRecoil Enginepr-downloaderCLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloaderGame AssetsEngine, Maps, Game filesTeiserverThe main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/PostgreSQLChobbyThe lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-ChobbyBAR GameThe actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason startsusesstarts Autohost ProtocolreadsreadsstartsstartsCLI invokewritesreadsbridge protocolSMTPSpringLobby protocolSpringLobby protocolEngine ProtocolSpringLobby protocoluploads replaysembedshttps://www.beyondallreason.info, built using [Webflow](https://webflow.com/) All game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setup We use multiple CDNs and endpoints for hosting different game assets and configuration.  We don't include all the arrows on the diagram for clarity. The server is provisioned and configured via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-teiserver BAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db Responsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcher A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface. Manages individual lobby rooms  Repo: https://github.com/Yaribz/SPADS CLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloader Engine, Maps, Game files The main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/ The lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-Chobby The actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason </p>"},{"location":"current_infra/#player-local-flow","title":"Player local flow","text":"<p>The main way players interact with the game is by launching and playing the game.</p> <p>The entry point of the interaction is Spring Launcher, which is installed by the user via installer and is responsible for downloading all the other components of the game directly and via pr-downloader distributed with the launcher.</p> <p>The launcher then starts the Recoil engine process with the \"Menu\" configured to be Chobby, which has the UI to log in, start a single-player game, etc. Chobby itself can't do much because it's written in Lua and constrained to use the engine APIs, but it has support for opening network sockets. For any advanced functions, e.g., Discord rich presence, triggering map downloads, it calls the launcher via the local network interface.</p> <p>Chobby connects to the lobby server (teiserver) using the SpringLobby protocol for multiplayer features. It's responsible for starting the game in the same engine instance it's running in. For details about starting the game in the engine, see the article in Engine documentation.</p>"},{"location":"current_infra/#multiplayer-lobbies","title":"Multiplayer lobbies","text":"<p>teiserver is the central component that Chobby and game servers connect to. It handles account management, rating, moderation, chat, and overall passing messages between different components.</p> <p>The one thing that teiserver doesn't do is create new rooms. The rooms are created by SPADS running on the Game Server. There is a single room per SPADS process, with a single special SPADS process used to start and stop new instances (see the diagram in the section below for details).</p> <p>The lobby room logic is then split between teiserver and SPADS (It's something that is player visible: <code>$</code> vs <code>!</code> commands). SPADS contains the vast majority of lobby room logic and is responsible for starting the multiplayer game: starting the special engine dedicated instance and sending players the connection parameters.</p> <p>SPADS communicates with the engine running on the server using the \"Autohost\" protocol and has admin privileges to execute different commands, e.g., the <code>!stop</code> command is executed in SPADS, and it's SPADS that resolves the vote and decides whether to stop the battle or not.</p>"},{"location":"current_infra/#auxiliary-services","title":"Auxiliary services","text":"<p>Players also have access to the main website: https://www.beyondallreason.info/. The website is created in Webflow, but it also contains <code>&lt;iframe&gt;</code> with pages from https://bar-rts.com/ (BAR Live Services) that contain more interactive parts: replay browser, list of active battles, etc. BAR Live Services is a custom frontend and backend hosted on a dedicated VM, with PostgreSQL, etc.</p>"},{"location":"current_infra/#game-server","title":"Game Server","text":"<p>Below diagram shows the Game Server setup in more detail.</p> <p>The game server is managed by an Ansible playbook: https://github.com/beyond-all-reason/ansible-spads-setup</p> <p>Recoil Engine (dedicated)SPADSSPADS (Cluster Manager)Game Assetscronpr-downloaderMap SyncerA dedicated service that watches changes in maps-metadata and makes sure that server has all the maps by downloading new ones and removing old.  Source: https://github.com/beyond-all-reason/maps-metadata/tree/main/tools/map_syncerSPADS ConfigurationAll SPADS configuration is stored in https://github.com/beyond-all-reason/spads_config_bar  The configuration incudes all plugins, their configuration, and a bunch of scripts used on the server.Replay Upload ScriptJust a small bash script that is triggered by SPADS to upload replay for public matches to BAR live servicespluginsWe run [*plenty*](https://github.com/beyond-all-reason/spads_config_bar/tree/main/var/plugins) of different plugins, we call out BAR manager as it's to some degree special.unitsync.soDynamically loaded `unitsync.so` library from engine distribution that is used to read information about assets, list game version, modoptions etc.pluginsBar ManagerA special BAR dedicated plugin with some BAR centric functionality.  Source: https://github.com/beyond-all-reason/spads_config_bar/blob/main/var/plugins/barmanager.pyCluster ManagerA plugin that monitors how many SPADS processes are running and spins up new ones as needed, to make sure there is always some free lobby room available. startsstarts Autohost ProtocolCLI invokewriteswritesreadsreadsreadsreadstrigger update scriptA dedicated service that watches changes in maps-metadata and makes sure that server has all the maps by downloading new ones and removing old.  Source: https://github.com/beyond-all-reason/maps-metadata/tree/main/tools/map_syncer All SPADS configuration is stored in https://github.com/beyond-all-reason/spads_config_bar  The configuration incudes all plugins, their configuration, and a bunch of scripts used on the server. Just a small bash script that is triggered by SPADS to upload replay for public matches to BAR live services We run [*plenty*](https://github.com/beyond-all-reason/spads_config_bar/tree/main/var/plugins) of different plugins, we call out BAR manager as it's to some degree special. Dynamically loaded `unitsync.so` library from engine distribution that is used to read information about assets, list game version, modoptions etc. A special BAR dedicated plugin with some BAR centric functionality.  Source: https://github.com/beyond-all-reason/spads_config_bar/blob/main/var/plugins/barmanager.py A plugin that monitors how many SPADS processes are running and spins up new ones as needed, to make sure there is always some free lobby room available. Recoil Engine (dedicated)SPADSSPADS (Cluster Manager)Game Assetscronpr-downloaderMap SyncerA dedicated service that watches changes in maps-metadata and makes sure that server has all the maps by downloading new ones and removing old.  Source: https://github.com/beyond-all-reason/maps-metadata/tree/main/tools/map_syncerSPADS ConfigurationAll SPADS configuration is stored in https://github.com/beyond-all-reason/spads_config_bar  The configuration incudes all plugins, their configuration, and a bunch of scripts used on the server.Replay Upload ScriptJust a small bash script that is triggered by SPADS to upload replay for public matches to BAR live servicespluginsWe run [*plenty*](https://github.com/beyond-all-reason/spads_config_bar/tree/main/var/plugins) of different plugins, we call out BAR manager as it's to some degree special.unitsync.soDynamically loaded `unitsync.so` library from engine distribution that is used to read information about assets, list game version, modoptions etc.pluginsBar ManagerA special BAR dedicated plugin with some BAR centric functionality.  Source: https://github.com/beyond-all-reason/spads_config_bar/blob/main/var/plugins/barmanager.pyCluster ManagerA plugin that monitors how many SPADS processes are running and spins up new ones as needed, to make sure there is always some free lobby room available. startsstarts Autohost ProtocolCLI invokewriteswritesreadsreadsreadsreadstrigger update scriptA dedicated service that watches changes in maps-metadata and makes sure that server has all the maps by downloading new ones and removing old.  Source: https://github.com/beyond-all-reason/maps-metadata/tree/main/tools/map_syncer All SPADS configuration is stored in https://github.com/beyond-all-reason/spads_config_bar  The configuration incudes all plugins, their configuration, and a bunch of scripts used on the server. Just a small bash script that is triggered by SPADS to upload replay for public matches to BAR live services We run [*plenty*](https://github.com/beyond-all-reason/spads_config_bar/tree/main/var/plugins) of different plugins, we call out BAR manager as it's to some degree special. Dynamically loaded `unitsync.so` library from engine distribution that is used to read information about assets, list game version, modoptions etc. A special BAR dedicated plugin with some BAR centric functionality.  Source: https://github.com/beyond-all-reason/spads_config_bar/blob/main/var/plugins/barmanager.py A plugin that monitors how many SPADS processes are running and spins up new ones as needed, to make sure there is always some free lobby room available. </p>"},{"location":"current_infra/#hosting","title":"Hosting","text":"<p>All runtime components are hosted on virtual machines that are manually provisioned and managed with Ansible playbooks (Game Server, Lobby Server). The VMs, and the infrastructure as a whole, are funded directly by donations. Access to this infrastructure is restricted to a few trusted volunteers.</p> <p>We do not accept private hosting or hardware donations. This policy is in place because we must retain full administrative access to the infrastructure to ensure compliance with our privacy policy. Relying on third-party hosting introduces significant operational risks and administrative overhead.</p>"},{"location":"new_client/","title":"New Client and Protocol","text":"<p>BAR is working towards a Steam release to provide a modern and stable player experience. One of the requirements for the release is a new client that will replace Chobby and a new protocol, Tachyon, which will work together to enable multiple improvements.</p>"},{"location":"new_client/#overview","title":"Overview","text":"<p>Important</p> <p>This overview assumes some familiarity with the current infrastructure setup as described on the Runtime Infrastructure page.</p> <p>PlayerPlayer's PCGame ServerAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setupTeiserverThe main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/BAR Live ServicesBAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-dbLegendSpring LauncherResponsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcherNew ClientNew Client build on Electron framework.  Repo: https://github.com/beyond-all-reason/bar-lobbyRecoil Engine (dedicated)A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface.SPADSManages individual lobby rooms  Repo: https://github.com/Yaribz/SPADSGame AssetsRecoil AutohostSpins ups new engine instances and translates communication between engine and teiserver.  Repo: https://github.com/beyond-all-reason/recoil-autohostRecoil Enginepr-downloaderCLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloaderGame AssetsEngine, Maps, Game filesNew ComponentsComponents that are added as part of the workDeprecated ComponentsComponents that are being deprecated and will be removed after this project is finishedChobbyThe lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-ChobbyBAR GameThe actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason startsstartsstarts Autohost ProtocolreadsreadsstartsAutohost ProtocolstartsstartsCLI invokestartsCLI invokewritesreadsbridge protocolSpringLobby protocolSpringLobby protocolEngine ProtocolSpringLobby protocoluploads replaysTachyon protocolTachyon protocol??? (to be designed)uploads replaysAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setup The main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/ BAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db Responsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcher New Client build on Electron framework.  Repo: https://github.com/beyond-all-reason/bar-lobby A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface. Manages individual lobby rooms  Repo: https://github.com/Yaribz/SPADS Spins ups new engine instances and translates communication between engine and teiserver.  Repo: https://github.com/beyond-all-reason/recoil-autohost CLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloader Engine, Maps, Game files Components that are added as part of the work Components that are being deprecated and will be removed after this project is finished The lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-Chobby The actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason PlayerPlayer's PCGame ServerAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setupTeiserverThe main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/BAR Live ServicesBAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-dbLegendSpring LauncherResponsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcherNew ClientNew Client build on Electron framework.  Repo: https://github.com/beyond-all-reason/bar-lobbyRecoil Engine (dedicated)A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface.SPADSManages individual lobby rooms  Repo: https://github.com/Yaribz/SPADSGame AssetsRecoil AutohostSpins ups new engine instances and translates communication between engine and teiserver.  Repo: https://github.com/beyond-all-reason/recoil-autohostRecoil Enginepr-downloaderCLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloaderGame AssetsEngine, Maps, Game filesNew ComponentsComponents that are added as part of the workDeprecated ComponentsComponents that are being deprecated and will be removed after this project is finishedChobbyThe lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-ChobbyBAR GameThe actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason startsstartsstarts Autohost ProtocolreadsreadsstartsAutohost ProtocolstartsstartsCLI invokestartsCLI invokewritesreadsbridge protocolSpringLobby protocolSpringLobby protocolEngine ProtocolSpringLobby protocoluploads replaysTachyon protocolTachyon protocol??? (to be designed)uploads replaysAll game servers are provisioned and maintained via Ansible playbook.  Repo: https://github.com/beyond-all-reason/ansible-spads-setup The main \"Server\" of the game. https://server4.beyondallreason.info/  It faciliates:  - Communication between players and hosts  - Accounts management  - Rating  - Moderation  Repo: https://github.com/beyond-all-reason/teiserver/ BAR Live Services https://bar-rts.com/ hosts replay, list of active matches etc  - Frontend: https://github.com/beyond-all-reason/bar-live-services - Backend: https://github.com/beyond-all-reason/bar-db Responsible for downloading and updating engine and all of the assets before launching the game.  Repo: https://github.com/beyond-all-reason/spring-launcher New Client build on Electron framework.  Repo: https://github.com/beyond-all-reason/bar-lobby A special version of Recoil Engine that doesn't run any simulation, but synchronizes and forwards all game commands between players.  All the communication between Game and SPADS/teiserver happens via Autohost interface. Manages individual lobby rooms  Repo: https://github.com/Yaribz/SPADS Spins ups new engine instances and translates communication between engine and teiserver.  Repo: https://github.com/beyond-all-reason/recoil-autohost CLI application that downloads updates in efficient format understood by the engine.  Repo: https://github.com/beyond-all-reason/pr-downloader Engine, Maps, Game files Components that are added as part of the work Components that are being deprecated and will be removed after this project is finished The lobby player sees when opening the game  Repo: https://github.com/beyond-all-reason/BYAR-Chobby The actual core Beyond All Reason game  Repo: https://github.com/beyond-all-reason/Beyond-All-Reason </p> <p>We can start with the protocol. All communication that currently uses the SpringLobby Protocol will switch to the new Tachyon Protocol. The SpringLobby Protocol was very successful in the past in the Spring RTS ecosystem, but it imposes many limitations on things that we would like to achieve in the future.</p> <p>On the client side, we are deprecating the in-engine lobby, Chobby, and spring-launcher with a single Electron-based application: New Client, also known as BAR Lobby. Because the New Client is based on web technologies, it should be much easier to develop, and more people are familiar with this technology (similar argument for the work of adapting RmlUi for in-game UI). Moreover, being a more native application, the New Client has access to full Operating System APIs, network APIs, and so on, which allows us to deprecate the launcher.</p> <p>We are also deprecating the SpringLobby Protocol usage for game servers. In the Tachyon Protocol, the game server component has different responsibilities than in SpringLobby: the battle room management is no longer shared between Teiserver and SPADS, which leads to bugs, but will be fully owned by Teiserver. That means that we won't be able to use SPADS, but we opted to develop a new Recoil Autohost component.</p>"},{"location":"new_client/#development","title":"Development","text":"<p>There is ongoing parallel work on all four components of the project: protocol, new client, Teiserver, and Recoil Autohost. The protocol is a central piece that requires the most coordination between project participants. Most development conversations are happening on Discord in dedicated channels, primarily #tachyon-protocol and #new-client.</p>"},{"location":"new_client/#new-client","title":"New Client","text":"<p>The roadmap with milestones is available at: https://github.com/beyond-all-reason/bar-lobby/wiki/Roadmap. This roadmap dictates the priorities for the development of all the other components.</p> <p>Technologies: TypeScript, Electron, Vue Repository: https://github.com/beyond-all-reason/bar-lobby</p>"},{"location":"new_client/#teiserver","title":"Teiserver","text":"<p>Most of the work involves implementing the Tachyon protocol endpoints. Relevant GitHub issues are tagged with the <code>tachyon</code> tag.</p> <p>Technologies: Elixir Repository: https://github.com/beyond-all-reason/teiserver</p>"},{"location":"new_client/#protocol","title":"Protocol","text":"<p>The protocol changes are driven primarily by the work in other components: if the new client needs some feature and there isn't an endpoint that provides that information, somebody volunteers to design it, and then it goes through a review process to agree on the schema, for example: Party specification Pull Request.</p> <p>Technologies: JSON Schema Repository: https://github.com/beyond-all-reason/tachyon</p>"},{"location":"new_client/#recoil-autohost","title":"Recoil Autohost","text":"<p>Like the new client, this is an entirely new component that already has some very basic functionality implemented. However, there are still quite a few missing features that need to be addressed to make it production quality. Known missing work items are broken down into GitHub issues.</p> <p>Technologies: TypeScript, Node.js Repository: https://github.com/beyond-all-reason/recoil-autohost</p>"}]}